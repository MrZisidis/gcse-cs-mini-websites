<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GCSE CS Mini Websites</title>
  <meta name="description" content="Mini websites for revision and homeworks for my GCSE CS Students" />
  <link rel="icon" href="/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Poppins font to match the provided style -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800">
  <!-- Header / Nav -->
  <header class="sticky top-0 z-50 bg-slate-50/80 backdrop-blur-lg border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <h1 class="text-xl md:text-2xl font-bold">
        <a href="./" class="inline-flex items-center gap-2 text-slate-900 hover:text-sky-700" aria-label="Home">
          <span aria-hidden="true">üè†</span>
          <span>GCSE CS Mini Websites</span>
        </a>
      </h1>

      <!-- Right-side nav -->
      <nav class="hidden md:block">
        <ul class="flex items-center gap-6">
          <li><a href="index.html#projects" class="text-slate-600 hover:text-sky-600 font-semibold">Projects</a></li>
          <li><a href="python_playground.html"
              class="text-sky-600 hover:text-sky-800 font-bold border-b-2 border-sky-600">Python Playground</a></li>
          <li>
            <a href="https://github.com/MrZisidis/gcse-cs-mini-websites"
              class="inline-flex items-center text-slate-600 hover:text-sky-600 font-semibold"
              aria-label="View repository on GitHub" rel="noopener noreferrer" target="_blank">
              <svg class="w-4 h-4 mr-2 fill-current" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
                  0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
                  -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64
                  -.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.01.08-2.11 0 0 .67-.21 2.2.82.64-.18
                  1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.91.08 2.11.51.56.82
                  1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55
                  .38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
              </svg>
              <span>Repository</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- CodeMirror & Pyodide CSS/JS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 h-full flex-grow flex flex-col">

    <div class="text-center mb-8">
      <h2 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">Python Playground üêç</h2>
      <p class="text-lg text-slate-600 max-w-3xl mx-auto">
        Write and run Python code directly in your browser! Select a starter file from the repository below or write
        your own from scratch.
      </p>
    </div>

    <!-- Playground Grid -->
    <div class="grid lg:grid-cols-12 gap-6 items-start">

      <!-- Sidebar: Repo Browser -->
      <div
        class="lg:col-span-3 bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden flex flex-col h-[600px]">
        <div class="bg-slate-100 p-4 border-b border-slate-200">
          <h3 class="font-bold text-slate-700 flex items-center gap-2">
            <span>üìÇ</span> Repository Files
          </h3>
          <p class="text-xs text-slate-500 mt-1 truncate" title="MrZisidis/GCSE-python-coding-playground">
            Source: GCSE-python-coding-playground
          </p>
        </div>

        <div id="file-list" class="flex-grow overflow-y-auto p-2 space-y-1">
          <div class="flex items-center justify-center h-full text-slate-400 text-sm animate-pulse">
            Loading files...
          </div>
        </div>

        <div class="p-3 border-t border-slate-200 bg-slate-50 text-center">
          <button id="refresh-repo-btn"
            class="text-xs text-sky-600 hover:text-sky-800 font-semibold flex items-center justify-center gap-1 w-full">
            <span>üîÑ</span> Refresh List
          </button>
        </div>
      </div>

      <!-- Main Editor Area -->
      <div class="lg:col-span-9 flex flex-col gap-4 h-full">

        <!-- Editor Toolbar -->
        <div class="flex items-center justify-between bg-slate-800 text-slate-300 px-4 py-2 rounded-t-lg">
          <div class="text-sm font-mono flex items-center gap-2">
            <span id="current-filename" class="font-bold text-white">main.py</span>
            <span class="text-xs text-slate-500">(Python 3.10 via Pyodide)</span>
          </div>
          <div class="flex gap-2">
            <button id="copy-btn"
              class="hover:text-white transition-colors text-xs uppercase font-bold tracking-wider px-2 py-1 rounded hover:bg-slate-700">
              Copy Code
            </button>
            <button id="clear-btn"
              class="hover:text-white transition-colors text-xs uppercase font-bold tracking-wider px-2 py-1 rounded hover:bg-slate-700">
              Clear Output
            </button>
          </div>
        </div>

        <!-- CodeMirror Editor Container -->
        <div class="border-x border-slate-200 h-[400px]">
          <textarea id="code-editor"># Welcome to the Python Playground!
# Select a file from the left to load it, or type here.

print("Hello, World!")
for i in range(3):
    print(f"Counting: {i}")
</textarea>
        </div>

        <!-- Controls & Output -->
        <div class="flex flex-col gap-0 rounded-b-lg overflow-hidden shadow-md border border-slate-200">
          <div class="bg-slate-100 p-2 flex justify-end border-t border-slate-200">
            <button id="run-btn"
              class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-8 rounded flex items-center gap-2 shadow-sm transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
              <span>‚ñ∂Ô∏è</span> Run Code
            </button>
          </div>
          <div class="bg-slate-900 p-4 font-mono text-sm h-[200px] overflow-y-auto w-full">
            <pre id="output-console" class="text-emerald-400 whitespace-pre-wrap">Ready to run.</pre>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script>
    // --- Configuration ---
    const GITHUB_REPO = "MrZisidis/GCSE-python-coding-playground";
    const API_URL = `https://api.github.com/repos/${GITHUB_REPO}/contents/`;

    // --- Editor Setup (CodeMirror) ---
    const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
      mode: "python",
      theme: "dracula",
      lineNumbers: true,
      indentUnit: 4,
      matchBrackets: true
    });
    // editor.setSize("100%", "400px"); // Ensure height matches container

    // --- Pyodide Setup ---
    let pyodide = null;
    const outputConsole = document.getElementById("output-console");
    const runBtn = document.getElementById("run-btn");

    async function loadPyodideEngine() {
      runBtn.disabled = true;
      runBtn.innerHTML = '<span>‚è≥</span> Loading Python...';
      try {
        pyodide = await loadPyodide();
        // Redirect stdout/stderr
        pyodide.setStdout({ batched: (msg) => addToConsole(msg) });
        pyodide.setStderr({ batched: (msg) => addToConsole(msg, true) });

        runBtn.disabled = false;
        runBtn.innerHTML = '<span>‚ñ∂Ô∏è</span> Run Code';
        addToConsole("Pyodide loaded. Python is ready!", false, true);
      } catch (err) {
        addToConsole(`Failed to load Pyodide: ${err}`, true);
      }
    }

    // --- Console Utilities ---
    function addToConsole(msg, isError = false, isSystem = false) {
      // Clear "Ready to run" initial message if present
      if (outputConsole.textContent.trim() === "Ready to run.") {
        outputConsole.textContent = "";
      }

      const span = document.createElement("div");
      span.textContent = msg;
      if (isError) span.className = "text-red-400 font-bold border-l-2 border-red-500 pl-2";
      else if (isSystem) span.className = "text-slate-500 italic";
      else span.className = "text-emerald-400"; // Default output

      outputConsole.appendChild(span);
      outputConsole.scrollTop = outputConsole.scrollHeight;
    }

    // --- Run Logic ---
    runBtn.addEventListener("click", async () => {
      if (!pyodide) return;

      const code = editor.getValue();
      outputConsole.innerHTML = ""; // Clear previous run output? Maybe optional. Let's clear for cleaner run.
      addToConsole("--- Running ---", false, true);

      try {
        // await pyodide.runPythonAsync(code); // runPythonAsync is better for inputs/sleeps
        // Actually, for simple scripts, loadPackagesFromImports might be needed if they use library code
        await pyodide.loadPackagesFromImports(code);
        await pyodide.runPythonAsync(code);
      } catch (err) {
        addToConsole(err, true);
      }
    });

    document.getElementById("clear-btn").addEventListener("click", () => {
      outputConsole.textContent = "Ready to run.";
    });

    document.getElementById("copy-btn").addEventListener("click", () => {
      navigator.clipboard.writeText(editor.getValue()).then(() => {
        const btn = document.getElementById("copy-btn");
        const originalText = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = originalText, 2000);
      });
    });

    // --- GitHub Repo Browser ---
    const fileListEl = document.getElementById("file-list");

    async function fetchRepoFiles() {
      fileListEl.innerHTML = '<div class="text-center text-slate-400 text-sm mt-4">Fetching file list...</div>';

      // Mock data fallback in case repo is missing or private
      const fallbackFiles = [
        { name: "01_hello.py", download_url: null, content: "print('Hello, Python World!')\nname = 'Alice'\nprint(f'Welcome, {name}')" },
        { name: "02_math.py", download_url: null, content: "x = 10\ny = 5\nprint(f'{x} + {y} = {x+y}')\nprint(f'{x} * {y} = {x*y}')" },
        { name: "03_loops.py", download_url: null, content: "print('Countdown!')\nfor i in range(5, 0, -1):\n    print(i)\nprint('Blastoff! üöÄ')" }
      ];

      try {
        const response = await fetch(API_URL);

        if (!response.ok) {
          console.warn("GitHub API failed or repo not found. Using fallback files.");
          renderFiles(fallbackFiles);
          return;
        }

        const data = await response.json();
        const pyFiles = data.filter(item => item.name.endsWith(".py") && item.type === "file");

        if (pyFiles.length === 0) {
          renderFiles(fallbackFiles);
          return;
        }

        renderFiles(pyFiles);

      } catch (err) {
        console.warn("Network error or Fetch failed. Using fallback files.", err);
        renderFiles(fallbackFiles);
      }
    }

    function renderFiles(files) {
      fileListEl.innerHTML = "";
      files.forEach(file => {
        const item = document.createElement("div");
        item.className = "group flex items-center justify-between p-2 rounded cursor-pointer hover:bg-sky-50 border border-transparent hover:border-sky-100 transition-colors";
        item.innerHTML = `
                <div class="flex items-center gap-2 overflow-hidden">
                    <span class="text-lg opacity-70 group-hover:opacity-100">üêç</span>
                    <span class="text-sm font-medium text-slate-700 group-hover:text-sky-700 truncate">${file.name}</span>
                </div>
            `;
        item.onclick = () => loadFileContent(file);
        fileListEl.appendChild(item);
      });
    }

    async function loadFileContent(fileObj) {
      try {
        document.getElementById("current-filename").textContent = "Loading...";

        let text = "";

        if (fileObj.content) {
          // It's a fallback file
          text = fileObj.content;
        } else if (fileObj.download_url) {
          // It's a real GitHub file
          const res = await fetch(fileObj.download_url);
          if (!res.ok) throw new Error("Failed to fetch file content");
          text = await res.text();
        }

        editor.setValue(text);
        document.getElementById("current-filename").textContent = fileObj.name;
      } catch (err) {
        addToConsole(`Error loading file: ${err.message}`, true);
      }
    }

    document.getElementById("refresh-repo-btn").addEventListener("click", fetchRepoFiles);

    // --- Initialization ---
    // Start Pyodide loading immediately
    loadPyodideEngine();
    // Fetch files
    fetchRepoFiles();

  </script>

  <!-- Footer -->
  <footer class="mt-12 py-8 border-t border-slate-200">
    <div
      class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-600 flex flex-col items-center gap-3">
      <div>
        ¬© <span id="year"></span> GCSE CS Mini Websites ‚Äî Built with ‚ù§Ô∏è
      </div>
      <div class="text-xs text-slate-500 flex flex-col md:flex-row items-center gap-2">
        <span>Copyright (c) 2025 Stefanos Zisidis. Licensed under <a href="https://creativecommons.org/licenses/by/4.0/"
            target="_blank" class="underline hover:text-sky-600">CC BY 4.0</a>.</span>
        <a href="https://github.com/MrZisidis/gcse-cs-mini-websites" target="_blank"
          class="inline-block text-slate-400 hover:text-slate-800 transition-colors" aria-label="GitHub">
          <svg viewBox="0 0 16 16" class="w-4 h-4 fill-current">
            <path
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52 -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64 -.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.01.08-2.11 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.91.08 2.11.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55 .38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
            </path>
          </svg>
        </a>
      </div>
    </div>
  </footer>

  <script>
    // small script to set the year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>

</html>